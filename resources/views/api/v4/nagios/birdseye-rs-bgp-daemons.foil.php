#
# Nagios configuration to check member peer sessions to Bird daemons via the Bird's Eye API
#
# Generated by IXP Manager on <?= date('Y-m-d H:i:s') . "\n" ?>
#
#
<?php
    $cmd_name = 'check_birdseye_bgp_session' . ( $t->vlanid ? ('_vlanid_' . $t->vlanid) : '' );
    $hg_name  = 'bird-daemons'          . ( $t->vlanid ? ('-vlanid-' . $t->vlanid) : '' );
?>

define command{
        command_name    <?= $cmd_name . "\n" ?>
        command_line    <?= config( 'ixp_api.nagios.birdseye_bgp_session_check' ) ?> -a $ARG1$ -p $ARG2$ -n
}

<?php foreach( $t->map as $m ): ?>

define service     {
        use                     <?= config( 'ixp_api.nagios.customer_service' ) . "\n" ?>
        host_name               <?= $m['hname'] . "\n" ?>
        service_description     <?= $m['name']  . "\n" ?>
        check_command           <?= $cmd_name ?>!<?= $m['api'] ?>!<?= $m['pname'] . "\n" ?>
}

<?php endforeach; ?>
